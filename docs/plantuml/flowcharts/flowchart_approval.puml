@startuml Flowchart_Approval_TindakLanjut
' ============================================================================
' FLOWCHART: ALUR APPROVAL TINDAK LANJUT
' ============================================================================
' Author: System Documentation
' Version: 2.1 (PlantUML) - Fixed: DITOLAK is FINAL status
' Date: 27 Desember 2024
' ============================================================================

!theme materia-outline

' === GLOBAL STYLING ===
skinparam backgroundColor #FEFEFE
skinparam shadowing false
skinparam defaultFontName "Segoe UI"
skinparam defaultFontSize 11
skinparam wrapWidth 200

' === ACTIVITY STYLING ===
skinparam activity {
    BackgroundColor #FFFFFF
    BorderColor #455A64
    FontColor #212121
    DiamondBackgroundColor #FFF8E1
    DiamondBorderColor #FF8F00
    DiamondFontColor #E65100
    ArrowColor #37474F
    BarColor #78909C
}

' === PARTITION STYLING ===
skinparam partition {
    BorderColor #9E9E9E
    FontColor #424242
    FontStyle bold
}

' === NOTE STYLING ===
skinparam note {
    BackgroundColor #FFFDE7
    BorderColor #FBC02D
    FontColor #5D4037
}

title <size:16>**FLOWCHART: ALUR APPROVAL TINDAK LANJUT**</size>\n<size:11>//Sistem Informasi Kedisiplinan SMK Negeri 1//</size>

' ============================================================================
' FASE 1: KASUS BARU (AUTO-GENERATED)
' ============================================================================

|#FFF3E0|<&cog> **RULES ENGINE**|
start

:Pelanggaran dicatat\ndan trigger rules;

:Generate **TindakLanjut**\n(status = BARU);

:Generate **SuratPanggilan**\n(draft otomatis);

|#E8F5E9|<&mail> **SISTEM NOTIFIKASI**|

:Kirim **notifikasi** ke:\n- Kepala Sekolah\n- Waka Kesiswaan;

note right
  Kasus langsung masuk ke
  daftar Pending Approval
  (auto-submit)
end note

' ============================================================================
' FASE 2: APPROVER REVIEW
' ============================================================================

|#FCE4EC|<&shield> **APPROVER (Kepsek / Waka)**|

:Terima **notifikasi**\nada kasus baru;

:Buka menu\n**Approval Tindak Lanjut**;

:Lihat daftar kasus\nmenunggu persetujuan;

:Pilih kasus untuk\ndi-review;

:Review **detail lengkap**:\n- Kronologi pelanggaran\n- Riwayat pelanggaran siswa\n- Sanksi yang diusulkan\n- Draft surat panggilan;

if (Setuju dengan\npenanganan?) then (<color:green>**APPROVE**</color>)
    
    |#E8F5E9|<&check> **SISTEM**|
    
    :Update status ke\n**DISETUJUI**;
    
    :Set **penyetuju_user_id**\n= current user;
    
    :Kirim **notifikasi** ke Pembina:\n//"Kasus telah disetujui"//;
    
    |#FCE4EC|<&shield> **APPROVER (Kepsek / Waka)**|
    
    #C8E6C9:Tampilkan pesan\n**"Berhasil disetujui"**;
    
else (<color:red>**REJECT**</color>)
    
    |#FCE4EC|<&shield> **APPROVER (Kepsek / Waka)**|
    
    :Input **alasan penolakan**\n(wajib diisi);
    
    :Klik **"Tolak"**;
    
    |#E8F5E9|<&x> **SISTEM**|
    
    :Update status ke\n**DITOLAK** (FINAL);
    
    :Simpan **alasan_tolak**;
    
    :Kirim **notifikasi** ke Pembina:\n//"Kasus ditolak: {alasan}"//;
    
    |#FCE4EC|<&shield> **APPROVER (Kepsek / Waka)**|
    
    #FFCDD2:Kasus **CLOSED (DITOLAK)**\nTidak dapat diubah lagi;
    
    note right
      **PENTING:**
      Status DITOLAK adalah FINAL.
      Kasus tidak dapat di-revisi
      atau di-submit ulang.
    end note
    
    stop
    
endif

' ============================================================================
' FASE 3: PEMBINA TANGANI KASUS
' ============================================================================

|#E3F2FD|<&person> **PEMBINA (Wali Kelas / Kaprodi)**|

:Terima **notifikasi**\nkasus disetujui;

:Buka detail kasus;

:Klik **"Mulai Tangani"**;

|#E8F5E9|<&play> **SISTEM**|

:Update status ke\n**DITANGANI**;

:Set **ditangani_oleh_user_id**;

:Set **ditangani_at** = now();

|#E3F2FD|<&person> **PEMBINA (Wali Kelas / Kaprodi)**|

:Lakukan **pertemuan**\ndengan orang tua/wali;

:Cetak **surat panggilan**\njika diperlukan;

:Input **hasil penanganan**;

:Klik **"Selesaikan"**;

|#E8F5E9|<&check> **SISTEM**|

:Update status ke\n**SELESAI** (FINAL);

:Set **diselesaikan_oleh_user_id**;

:Set **diselesaikan_at** = now();

#C8E6C9:Kasus **CLOSED (SELESAI)**;

stop

legend right
  <b>LEGENDA</b>
  ────────────────
  <back:#FFF3E0>    </back> Rules Engine
  <back:#E3F2FD>    </back> Pembina
  <back:#FCE4EC>    </back> Approver
  <back:#E8F5E9>    </back> Sistem
  ────────────────
  <b>Status Flow:</b>
  BARU → DISETUJUI → DITANGANI → **SELESAI**
       ↘ **DITOLAK** (FINAL)
  ────────────────
  **Note:** Status DITOLAK dan
  SELESAI adalah FINAL,
  tidak dapat diubah lagi.
endlegend

footer \n//Generated by PlantUML | Sistem Kedisiplinan Siswa SMK Negeri 1//

@enduml
