@startuml Flowchart_Pencatatan_Pelanggaran
' ============================================================================
' FLOWCHART: ALUR PENCATATAN PELANGGARAN SISWA
' ============================================================================
' Author: System Documentation
' Version: 2.1 (PlantUML) - Fixed backward error
' Date: 27 Desember 2024
' ============================================================================

!theme materia-outline

' === GLOBAL STYLING ===
skinparam backgroundColor #FEFEFE
skinparam shadowing false
skinparam defaultFontName "Segoe UI"
skinparam defaultFontSize 11
skinparam wrapWidth 200

' === ACTIVITY STYLING ===
skinparam activity {
    BackgroundColor #FFFFFF
    BorderColor #455A64
    FontColor #212121
    DiamondBackgroundColor #FFF8E1
    DiamondBorderColor #FF8F00
    DiamondFontColor #E65100
    ArrowColor #37474F
    BarColor #78909C
}

' === NOTE STYLING ===
skinparam note {
    BackgroundColor #FFFDE7
    BorderColor #FBC02D
    FontColor #5D4037
}

title <size:16>**FLOWCHART: ALUR PENCATATAN PELANGGARAN SISWA**</size>\n<size:11>//Sistem Informasi Kedisiplinan SMK Negeri 1//</size>

|#E3F2FD|<&person> **GURU**|
start

:Buka menu\n**Catat Pelanggaran**;

:Cari/Pilih **Siswa**\nberdasarkan nama atau NISN;

:Pilih **Jenis Pelanggaran**\ndari dropdown list;

|#FFF3E0|<&cog> **RULES ENGINE**|

:Hitung **frekuensi ke-N**\npelanggaran siswa ini\nuntuk jenis yang sama;

:Cari **Frequency Rule**\nyang match dengan frekuensi;

note right
  Contoh Frequency Rules:
  - Frekuensi 1: 5 poin
  - Frekuensi 2: 10 poin
  - Frekuensi 3: 15 poin + Surat
end note

if (Frequency Rule\nmatch?) then (<color:green>**Ya**</color>)
    :Ambil **poin** dan **sanksi**\ndari matched rule;
else (<color:red>**Tidak**</color>)
    :Poin = 0\n(belum mencapai threshold);
endif

|<&person> **GURU**|

:Input **tanggal kejadian**\n(default: hari ini);

:Input **keterangan** tambahan\n//(opsional)//;

:Upload **bukti foto**\n//(opsional)//;

:Klik tombol **SIMPAN**;

|#E8F5E9|<&database> **SISTEM**|

:Simpan data ke\n**riwayat_pelanggaran**;

fork
    :Cek **Frequency Rules**\nuntuk trigger tindak lanjut;
fork again
    :Cek **Pembinaan Rules**\nuntuk trigger pembinaan;
end fork

|#FFF3E0|<&cog> **RULES ENGINE**|

if (Trigger **Surat Panggilan**?) then (<color:green>**Ya**</color>)
    |#E8F5E9|<&database> **SISTEM**|
    
    :Generate **TindakLanjut**\n(status = BARU);
    
    :Generate **SuratPanggilan**\n(draft otomatis);
    
    :Tentukan **pembina_roles**\nberdasarkan rule;
    
    note right
      Pembina sesuai level:
      - Ringan: Wali Kelas
      - Sedang: + Kaprodi
      - Berat: + Waka + Kepsek
    end note
    
    :Kirim **notifikasi**\nke approver;
else (<color:red>**Tidak**</color>)
endif

|#FFF3E0|<&cog> **RULES ENGINE**|

if (Total poin masuk\nrange **Pembinaan**?) then (<color:green>**Ya**</color>)
    |#E8F5E9|<&database> **SISTEM**|
    
    :Generate **PembinaanStatus**\n(status = PERLU_PEMBINAAN);
    
    :Set pembina_roles\nsesuai range poin;
    
    :Kirim **notifikasi**\nke pembina pembinaan;
else (<color:red>**Tidak**</color>)
endif

|<&person> **GURU**|

#C8E6C9:Tampilkan **pesan sukses**\n"Pelanggaran berhasil dicatat";

if (Trigger tindak lanjut/pembinaan?) then (<color:green>**Ya**</color>)
    :Tampilkan **info tambahan**\ntentang tindak lanjut/pembinaan\nyang di-generate;
else (<color:red>**Tidak**</color>)
endif

stop

legend right
  <b>LEGENDA</b>
  ----
  <back:#E3F2FD>    </back> Aktor: Guru
  <back:#E8F5E9>    </back> Sistem / Database
  <back:#FFF3E0>    </back> Rules Engine
  ----
  <b>Symbols:</b>
  ○  Start/End
  ▭  Process
  ◇  Decision
  ═══ Fork/Join (parallel)
endlegend

footer \n//Generated by PlantUML | Sistem Kedisiplinan Siswa SMK Negeri 1//

@enduml
